<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>About - Security Camera UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{font-family:system-ui,Arial,sans-serif}
    body{margin:0;background:#0b0c10;color:#e8e8e8}
    header{padding:14px 18px;background:#111318;position:sticky;top:0;z-index:10;display:flex;gap:10px;flex-wrap:wrap;align-items:end}
    header h1{margin:0;font-size:18px;font-weight:700}
    .nav{display:flex;gap:8px;flex-wrap:wrap}
    .nav a{background:#171a21;color:#e8e8e8;border:1px solid #2a2f3a;border-radius:8px;padding:8px 10px;text-decoration:none;transition:all 0.2s}
    .nav a:hover{background:#2a2f3a}
    .nav a.active{background:#375dfb;border-color:#375dfb;color:#fff}
    main{padding:20px;max-width:800px;margin:0 auto}
    .info-card{background:#111318;border:1px solid #2a2f3a;border-radius:14px;padding:20px;margin-bottom:20px}
    .info-card h2{margin:0 0 15px 0;font-size:18px;font-weight:600;color:#375dfb}
    .info-card h3{margin:15px 0 10px 0;font-size:16px;font-weight:600}
    .info-card p{margin:10px 0;line-height:1.6;opacity:.9}
    .info-card ul{margin:10px 0;padding-left:20px}
    .info-card li{margin:5px 0;opacity:.9}
    .status-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin:20px 0}
    .status-item{background:#1a1d29;border:1px solid #2a2f3a;border-radius:10px;padding:15px;text-align:center}
    .status-item .value{font-size:20px;font-weight:700;color:#375dfb;margin-bottom:5px}
    .status-item .label{font-size:12px;opacity:.8}
    .feature-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin:20px 0}
    .feature-item{background:#1a1d29;border:1px solid #2a2f3a;border-radius:10px;padding:15px}
    .feature-item h4{margin:0 0 10px 0;color:#375dfb;font-size:14px;font-weight:600}
    .feature-item p{margin:0;font-size:12px;opacity:.8;line-height:1.4}
    .loading{text-align:center;padding:40px;opacity:.6}
    .error{background:#ff444420;border:1px solid #ff4444;color:#ff6666;padding:15px;border-radius:8px;margin:20px 0}
    
    /* Mobile Navigation Styles */
    .mobile-menu-toggle {
      display: none;
      background: #171a21;
      color: #e8e8e8;
      border: 1px solid #2a2f3a;
      border-radius: 8px;
      padding: 8px 10px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    
    .mobile-menu-toggle:hover {
      background: #2a2f3a;
      transform: scale(1.05);
    }
    
    .mobile-menu-toggle .hamburger {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    
    .mobile-menu-toggle .hamburger span {
      width: 18px;
      height: 2px;
      background: #e8e8e8;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 1px;
    }
    
    .mobile-menu-toggle.active .hamburger span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }
    
    .mobile-menu-toggle.active .hamburger span:nth-child(2) {
      opacity: 0;
      transform: scaleX(0);
    }
    
    .mobile-menu-toggle.active .hamburger span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }
    
    .mobile-nav {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #111318;
      border: 1px solid #2a2f3a;
      border-top: none;
      border-radius: 0 0 12px 12px;
      padding: 16px;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      transform: translateY(-10px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .mobile-nav.show {
      display: block;
      transform: translateY(0);
      opacity: 1;
    }
    
    .mobile-nav .nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .mobile-nav .nav a {
      background: #171a21;
      color: #e8e8e8;
      border: 1px solid #2a2f3a;
      border-radius: 10px;
      padding: 14px 18px;
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-align: center;
      font-weight: 500;
      position: relative;
      overflow: hidden;
    }
    
    .mobile-nav .nav a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(55, 93, 251, 0.1), transparent);
      transition: left 0.5s;
    }
    
    .mobile-nav .nav a:hover::before {
      left: 100%;
    }
    
    .mobile-nav .nav a:hover {
      background: #2a2f3a;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(55, 93, 251, 0.2);
    }
    
    .mobile-nav .nav a.active {
      background: linear-gradient(135deg, #375dfb, #4a6cf7);
      border-color: #375dfb;
      color: #fff;
      box-shadow: 0 4px 16px rgba(55, 93, 251, 0.3);
    }
    
    /* Mobile responsive styles */
    @media (max-width: 768px) {
      header {
        flex-wrap: wrap;
        position: relative;
        padding: 12px 16px;
      }
      
      header h1 {
        font-size: 16px;
      }
      
      .nav {
        display: none;
      }
      
      .mobile-menu-toggle {
        display: block;
        margin-left: auto;
      }
      
      main {
        padding: 16px;
        max-width: none;
      }
      
      .info-card {
        padding: 16px;
        margin-bottom: 16px;
        border-radius: 12px;
      }
      
      .status-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      .feature-list {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .feature-item {
        padding: 12px;
        border-radius: 8px;
      }
      
      .status-item {
        padding: 12px;
        border-radius: 8px;
      }
      
      .status-item .value {
        font-size: 18px;
      }
    }
    
    @media (max-width: 480px) {
      header {
        padding: 10px 12px;
      }
      
      header h1 {
        font-size: 14px;
      }
      
      main {
        padding: 12px;
      }
      
      .info-card {
        padding: 12px;
        border-radius: 10px;
      }
      
      .status-grid {
        grid-template-columns: 1fr;
      }
      
      .status-item .value {
        font-size: 16px;
      }
      
      .feature-item h4 {
        font-size: 13px;
      }
      
      .feature-item p {
        font-size: 11px;
      }
      
      /* Mobile button improvements */
      .info-card div[style*="display: flex"] {
        flex-direction: column !important;
        gap: 12px !important;
      }
      
      .info-card button {
        width: 100% !important;
        min-width: unset !important;
        padding: 14px 20px !important;
        font-size: 16px !important;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>About Security Camera UI</h1>
    <nav class="nav">
      <a href="/ui/detections.html">AI Detections</a>
      <a href="/ui/events.html">Events</a>
      <a href="/ui/stats.html">Stats</a>
      <a href="/ui/about.html" class="active">About</a>
    </nav>
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
      <div class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    
    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <nav class="nav">
        <a href="/ui/detections.html">AI Detections</a>
        <a href="/ui/events.html">Events</a>
        <a href="/ui/stats.html">Stats</a>
        <a href="/ui/about.html" class="active">About</a>
      </nav>
    </div>
  </header>
  <main>
    <div class="info-card">
      <h2>System Overview</h2>
      <p>Security Camera UI is a modern web interface for monitoring and analyzing security camera footage. It provides real-time event browsing, motion detection statistics, and comprehensive analytics.</p>
      
      <h3>Key Features</h3>
      <div class="feature-list">
        <div class="feature-item">
          <h4>üìπ Event Browser</h4>
          <p>Browse security camera events with thumbnail previews, filtering by camera, date, and file size.</p>
        </div>
        <div class="feature-item">
          <h4>üìä Motion Analytics</h4>
          <p>Comprehensive statistics and charts showing motion detection patterns, daily trends, and camera usage.</p>
        </div>
        <div class="feature-item">
          <h4>üé• Video Playback</h4>
          <p>Inline video player with controls, fullscreen support, and optimized streaming for security footage.</p>
        </div>
        <div class="feature-item">
          <h4>üñºÔ∏è Image Viewer</h4>
          <p>Fullscreen image viewer for security snapshots with zoom and navigation controls.</p>
        </div>
        <div class="feature-item">
          <h4>üîç Smart Filtering</h4>
          <p>Advanced filtering by camera, date range, file size, and motion detection type.</p>
        </div>
        <div class="feature-item">
          <h4>üìà Real-time Updates</h4>
          <p>Live scanning status and automatic refresh when new events are detected.</p>
        </div>
      </div>
    </div>

    <div class="info-card">
      <h2>System Status</h2>
      <div id="status-loading" class="loading">Loading system status...</div>
      <div id="status-error" class="error" style="display:none"></div>
      <div id="status-content" style="display:none">
        <div class="status-grid" id="status-grid"></div>
        <div style="margin-top: 20px; text-align: center;">
          <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <button id="cleanup-btn" style="background: #ff4444; color: white; border: 1px solid #ff4444; border-radius: 8px; padding: 10px 20px; cursor: pointer; flex: 1; min-width: 200px;">
              Clean Up Deleted Files
            </button>
            <button id="debug-stats-btn" style="background: #375dfb; color: white; border: 1px solid #375dfb; border-radius: 8px; padding: 10px 20px; cursor: pointer; flex: 1; min-width: 200px;">
              üîß Debug Stats
            </button>
          </div>
          <div id="cleanup-result" style="margin-top: 10px; font-size: 14px;"></div>
        </div>
      </div>
    </div>

    <div class="info-card">
      <h2>Technical Details</h2>
      <h3>Architecture</h3>
      <ul>
        <li><strong>Backend:</strong> Go with Gin web framework</li>
        <li><strong>Database:</strong> SQLite for event storage and indexing</li>
        <li><strong>Frontend:</strong> Vanilla JavaScript with Chart.js for analytics</li>
        <li><strong>Streaming:</strong> HTTP range requests for efficient video streaming</li>
        <li><strong>Thumbnails:</strong> Automatic generation and caching system</li>
      </ul>
      
      <h3>Performance Features</h3>
      <ul>
        <li><strong>Lazy Loading:</strong> Images and videos load on demand</li>
        <li><strong>Compression:</strong> Gzip compression for faster data transfer</li>
        <li><strong>Caching:</strong> Aggressive caching for thumbnails and static assets</li>
        <li><strong>Pagination:</strong> Efficient pagination for large event collections</li>
        <li><strong>Background Processing:</strong> Non-blocking thumbnail generation</li>
      </ul>
    </div>

    <div class="info-card">
      <h2>API Endpoints</h2>
      <h3>Core Endpoints</h3>
      <ul>
        <li><code>GET /events</code> - List security camera events with filtering</li>
        <li><code>GET /stats/motion</code> - Motion detection statistics and analytics</li>
        <li><code>GET /thumb/:id</code> - Serve thumbnail images</li>
        <li><code>GET /stream/:id</code> - Stream video files with range support</li>
        <li><code>POST /events/:id/reviewed</code> - Mark events as reviewed</li>
      </ul>
      
      <h3>System Endpoints</h3>
      <ul>
        <li><code>GET /scan-status</code> - Current scanning and indexing status</li>
        <li><code>GET /health</code> - System health check</li>
        <li><code>GET /stats</code> - Basic system statistics</li>
        <li><code>GET /perf</code> - Performance metrics</li>
      </ul>
    </div>
  </main>

<script>
const statusLoading = document.getElementById('status-loading');
const statusError = document.getElementById('status-error');
const statusContent = document.getElementById('status-content');
const statusGrid = document.getElementById('status-grid');

async function loadSystemStatus() {
  try {
    // Load multiple status endpoints in parallel
    const [scanStatus, basicStats, perfStats] = await Promise.all([
      fetch('/scan-status').then(r => r.ok ? r.json() : null).catch(() => null),
      fetch('/stats').then(r => r.ok ? r.json() : null).catch(() => null),
      fetch('/perf').then(r => r.ok ? r.json() : null).catch(() => null)
    ]);

    let statusData = {};
    
    if (scanStatus) {
      statusData = {
        ...statusData,
        totalEvents: scanStatus.totalEvents || 0,
        videoEvents: scanStatus.videoEvents || 0,
        thumbnailsGenerated: scanStatus.thumbnailsGenerated || 0,
        scanning: scanStatus.scanning || false
      };
    }
    
    if (basicStats) {
      statusData.events = basicStats.events || 0;
    }
    
    if (perfStats) {
      statusData.thumbnailCoverage = perfStats.thumbnailCoverage || 0;
    }

    // Display status
    statusGrid.innerHTML = `
      <div class="status-item">
        <div class="value">${statusData.totalEvents?.toLocaleString() || 'N/A'}</div>
        <div class="label">Total Events</div>
      </div>
      <div class="status-item">
        <div class="value">${statusData.videoEvents?.toLocaleString() || 'N/A'}</div>
        <div class="label">Video Events</div>
      </div>
      <div class="status-item">
        <div class="value">${statusData.thumbnailsGenerated?.toLocaleString() || 'N/A'}</div>
        <div class="label">Thumbnails</div>
      </div>
      <div class="status-item">
        <div class="value">${statusData.thumbnailCoverage ? statusData.thumbnailCoverage.toFixed(1) + '%' : 'N/A'}</div>
        <div class="label">Thumbnail Coverage</div>
      </div>
      <div class="status-item">
        <div class="value">${statusData.scanning ? 'Active' : 'Idle'}</div>
        <div class="label">Scanning Status</div>
      </div>
    `;

    statusLoading.style.display = 'none';
    statusContent.style.display = 'block';

  } catch (e) {
    console.error('Failed to load system status:', e);
    statusLoading.style.display = 'none';
    statusError.style.display = 'block';
    statusError.textContent = 'Failed to load system status: ' + e.message;
  }
}

// Mobile menu functionality
const mobileMenuToggle = document.getElementById('mobileMenuToggle');
const mobileNav = document.getElementById('mobileNav');

// Toggle mobile menu
mobileMenuToggle.addEventListener('click', function() {
  mobileMenuToggle.classList.toggle('active');
  mobileNav.classList.toggle('show');
});

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  if (!mobileMenuToggle.contains(event.target) && !mobileNav.contains(event.target)) {
    mobileMenuToggle.classList.remove('active');
    mobileNav.classList.remove('show');
  }
});

// Load system status on page load
loadSystemStatus();

// Cleanup functionality
document.getElementById('cleanup-btn').addEventListener('click', async () => {
  const btn = document.getElementById('cleanup-btn');
  const result = document.getElementById('cleanup-result');
  
  btn.disabled = true;
  btn.textContent = 'Cleaning up...';
  result.textContent = '';
  
  try {
    const response = await fetch('/cleanup', { method: 'POST' });
    const data = await response.json();
    
    if (response.ok) {
      result.textContent = `‚úÖ Cleaned up ${data.cleaned} orphaned database entries`;
      result.style.color = '#44ff44';
      
      // Reload system status to show updated counts
      setTimeout(() => loadSystemStatus(), 1000);
    } else {
      result.textContent = `‚ùå Error: ${data.error}`;
      result.style.color = '#ff6666';
    }
  } catch (e) {
    result.textContent = `‚ùå Error: ${e.message}`;
    result.style.color = '#ff6666';
  } finally {
    btn.disabled = false;
    btn.textContent = 'Clean Up Deleted Files';
  }
});

// Debug stats functionality
document.getElementById('debug-stats-btn').addEventListener('click', () => {
  window.location.href = '/ui/debug-stats.html';
});
</script>
</body>
</html>
