<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuration - Security Camera UI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1116;
            color: #e8e8e8;
            line-height: 1.6;
        }
        
        header {
            padding: 14px 18px;
            background: #111318;
            position: sticky;
            top: 0;
            z-index: 10;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: end;
        }
        
        header h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: #e8e8e8;
        }
        
        .nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .nav a {
            background: #171a21;
            color: #e8e8e8;
            border: 1px solid #2a2f3a;
            border-radius: 8px;
            padding: 8px 10px;
            text-decoration: none;
            transition: all 0.2s;
        }
        
        .nav a:hover {
            background: #2a2f3a;
        }
        
        .nav a.active {
            background: #375dfb;
            border-color: #375dfb;
            color: #fff;
        }
        
        main {
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .config-section {
            background: #1a1d26;
            border: 1px solid #2a2f3a;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        
        .config-section h2 {
            color: #e8e8e8;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .config-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .config-item label {
            color: #e8e8e8;
            font-weight: 500;
            font-size: 14px;
        }
        
        .config-item input,
        .config-item select,
        .config-item textarea {
            background: #0f1116;
            color: #e8e8e8;
            border: 1px solid #2a2f3a;
            border-radius: 8px;
            padding: 12px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .config-item input[style*="flex: 1"] {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            border-right: none;
        }
        
        .config-item button[style*="white-space: nowrap"] {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-left: 1px solid #2a2f3a;
        }
        
        .config-item input:focus,
        .config-item select:focus,
        .config-item textarea:focus {
            outline: none;
            border-color: #375dfb;
            box-shadow: 0 0 0 3px rgba(55, 93, 251, 0.1);
        }
        
        .config-item textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .config-item .help-text {
            color: #8b949e;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .config-item .error {
            color: #ff6b6b;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .config-item .success {
            color: #51cf66;
            font-size: 12px;
            margin-top: 4px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        button {
            background: #375dfb;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: #4a6cf7;
            transform: translateY(-1px);
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        button.secondary {
            background: #2a2f3a;
            color: #e8e8e8;
        }
        
        button.secondary:hover {
            background: #3a4049;
        }
        
        button.danger {
            background: #dc3545;
        }
        
        button.danger:hover {
            background: #c82333;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: #51cf66;
        }
        
        .status-warning {
            background: #ffd43b;
        }
        
        .status-offline {
            background: #ff6b6b;
        }
        
        .test-results {
            margin-top: 16px;
            padding: 16px;
            background: #0f1116;
            border: 1px solid #2a2f3a;
            border-radius: 8px;
            display: none;
        }
        
        .test-results.show {
            display: block;
        }
        
        .test-results.success {
            border-color: #51cf66;
            background: rgba(81, 207, 102, 0.1);
        }
        
        .test-results.error {
            border-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }
        
        .test-results h4 {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-results pre {
            background: #1a1d26;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* Mobile Navigation Styles */
        .mobile-menu-toggle {
            display: none;
            background: #171a21;
            color: #e8e8e8;
            border: 1px solid #2a2f3a;
            border-radius: 8px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .mobile-menu-toggle:hover {
            background: #2a2f3a;
            transform: scale(1.05);
        }
        
        .mobile-menu-toggle .hamburger {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .mobile-menu-toggle .hamburger span {
            width: 18px;
            height: 2px;
            background: #e8e8e8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 1px;
        }
        
        .mobile-menu-toggle.active .hamburger span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .mobile-menu-toggle.active .hamburger span:nth-child(2) {
            opacity: 0;
            transform: scaleX(0);
        }
        
        .mobile-menu-toggle.active .hamburger span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        .mobile-nav {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #111318;
            border: 1px solid #2a2f3a;
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 16px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            transform: translateY(-10px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .mobile-nav.show {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }
        
        .mobile-nav .nav {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .mobile-nav .nav a {
            background: #171a21;
            color: #e8e8e8;
            border: 1px solid #2a2f3a;
            border-radius: 10px;
            padding: 14px 18px;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        
        .mobile-nav .nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(55, 93, 251, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .mobile-nav .nav a:hover::before {
            left: 100%;
        }
        
        .mobile-nav .nav a:hover {
            background: #2a2f3a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(55, 93, 251, 0.2);
        }
        
        .mobile-nav .nav a.active {
            background: linear-gradient(135deg, #375dfb, #4a6cf7);
            border-color: #375dfb;
            color: #fff;
            box-shadow: 0 4px 16px rgba(55, 93, 251, 0.3);
        }
        
        /* Mobile responsive styles */
        @media (max-width: 768px) {
            header {
                flex-wrap: wrap;
                position: relative;
                padding: 12px 16px;
            }
            
            header h1 {
                font-size: 16px;
            }
            
            .nav {
                display: none;
            }
            
            .mobile-menu-toggle {
                display: block;
                margin-left: auto;
            }
            
            main {
                padding: 16px;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 10px 12px;
            }
            
            header h1 {
                font-size: 14px;
            }
            
            main {
                padding: 12px;
            }
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #375dfb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .alert.info {
            background: rgba(55, 93, 251, 0.1);
            border: 1px solid #375dfb;
            color: #8bb4ff;
        }
        
        .alert.warning {
            background: rgba(255, 212, 59, 0.1);
            border: 1px solid #ffd43b;
            color: #ffd43b;
        }
        
        .alert.error {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
        }
        
        .alert.success {
            background: rgba(81, 207, 102, 0.1);
            border: 1px solid #51cf66;
            color: #51cf66;
        }
    </style>
</head>
<body>
    <header>
        <h1>Configuration</h1>
        <nav class="nav">
            <a href="/ui/detections.html">AI Detections</a>
            <a href="/ui/events.html">Events</a>
            <a href="/ui/stats.html">Stats</a>
            <a href="/ui/about.html">About</a>
        </nav>
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        
        <!-- Mobile Navigation -->
        <div class="mobile-nav" id="mobileNav">
            <nav class="nav">
                <a href="/ui/detections.html">AI Detections</a>
                <a href="/ui/events.html">Events</a>
                <a href="/ui/stats.html">Stats</a>
                <a href="/ui/about.html">About</a>
                <a href="/ui/config.html" class="active">⚙️ Configuration</a>
            </nav>
        </div>
    </header>
    
    <main>
        <!-- System Status Alert -->
        <div class="alert info" id="statusAlert" style="display: none;">
            <span>ℹ️</span>
            <div>
                <strong>Configuration Status:</strong>
                <span id="statusMessage">Loading configuration...</span>
            </div>
        </div>
        
        
        <!-- Camera Directory Configuration -->
        <div class="config-section">
            <h2>📁 Camera Directory</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="cameraDir">Camera Footage Directory</label>
                    <input type="text" id="cameraDir" placeholder="/path/to/camera/footage">
                    <div class="help-text">Main directory where camera footage is stored. Should contain subdirectories for each camera.</div>
                    <div class="error" id="cameraDirError"></div>
                </div>
                <div class="config-item">
                    <label for="cameraDirTest">Test Directory Access</label>
                    <button type="button" id="testCameraDir" class="secondary">Test Access</button>
                    <div class="test-results" id="cameraDirTestResults"></div>
                </div>
            </div>
        </div>
        
        <!-- Server Configuration -->
        <div class="config-section">
            <h2>🌐 Server Settings</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="serverHost">Host Address</label>
                    <input type="text" id="serverHost" placeholder="0.0.0.0">
                    <div class="help-text">IP address to bind the server to. Use 0.0.0.0 for all interfaces.</div>
                </div>
                <div class="config-item">
                    <label for="serverPort">Port</label>
                    <input type="number" id="serverPort" placeholder="8080" min="1" max="65535">
                    <div class="help-text">Port number for the web server.</div>
                </div>
                <div class="config-item">
                    <label for="corsOrigins">CORS Origins</label>
                    <input type="text" id="corsOrigins" placeholder="*">
                    <div class="help-text">Comma-separated list of allowed origins for CORS.</div>
                </div>
            </div>
        </div>
        
        <!-- Database Configuration -->
        <div class="config-section">
            <h2>🗃️ Database Settings</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="dbPath">Database Path</label>
                    <input type="text" id="dbPath" placeholder="./data/events.db">
                    <div class="help-text">Path to the SQLite database file.</div>
                </div>
                <div class="config-item">
                    <label for="dbBackupEnabled">Enable Auto Backup</label>
                    <select id="dbBackupEnabled">
                        <option value="true">Enabled</option>
                        <option value="false">Disabled</option>
                    </select>
                    <div class="help-text">Automatically backup database at regular intervals.</div>
                </div>
                <div class="config-item">
                    <label for="dbBackupInterval">Backup Interval</label>
                    <select id="dbBackupInterval">
                        <option value="1h">Every Hour</option>
                        <option value="6h">Every 6 Hours</option>
                        <option value="12h">Every 12 Hours</option>
                        <option value="24h">Daily</option>
                    </select>
                    <div class="help-text">How often to create database backups.</div>
                </div>
            </div>
        </div>
        
        <!-- AI Detection Configuration -->
        <div class="config-section">
            <h2>🤖 AI Detection Settings</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="gpuDetectionUrl">GPU Detection Service URL</label>
                    <input type="text" id="gpuDetectionUrl" placeholder="http://localhost:8000">
                    <div class="help-text">URL of the GPU detection service for AI processing.</div>
                </div>
                <div class="config-item">
                    <label for="gpuDetectionTimeout">Detection Timeout (seconds)</label>
                    <input type="number" id="gpuDetectionTimeout" placeholder="30" min="1" max="300">
                    <div class="help-text">Timeout for AI detection requests.</div>
                </div>
                <div class="config-item">
                    <label for="detectionConfidence">Default Confidence Threshold</label>
                    <input type="number" id="detectionConfidence" placeholder="0.45" min="0" max="1" step="0.01">
                    <div class="help-text">Minimum confidence score for detections (0.0 to 1.0).</div>
                </div>
                <div class="config-item">
                    <label for="detectionClasses">Detection Classes</label>
                    <textarea id="detectionClasses" placeholder="person,car,truck,bus,bicycle,motorcycle,dog,bird"></textarea>
                    <div class="help-text">Comma-separated list of object types to detect.</div>
                </div>
            </div>
        </div>
        
        <!-- Performance Configuration -->
        <div class="config-section">
            <h2>⚡ Performance Settings</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="maxWorkers">Maximum Workers</label>
                    <input type="number" id="maxWorkers" placeholder="8" min="1" max="32">
                    <div class="help-text">Maximum number of concurrent file processing workers.</div>
                </div>
                <div class="config-item">
                    <label for="thumbnailQuality">Thumbnail Quality</label>
                    <input type="number" id="thumbnailQuality" placeholder="85" min="1" max="100">
                    <div class="help-text">JPEG quality for generated thumbnails (1-100).</div>
                </div>
                <div class="config-item">
                    <label for="thumbnailSize">Thumbnail Size</label>
                    <input type="number" id="thumbnailSize" placeholder="320" min="64" max="1024">
                    <div class="help-text">Maximum size for generated thumbnails in pixels.</div>
                </div>
                <div class="config-item">
                    <label for="cacheSize">Cache Size (MB)</label>
                    <input type="number" id="cacheSize" placeholder="100" min="10" max="1000">
                    <div class="help-text">Maximum cache size for thumbnails and processed data.</div>
                </div>
            </div>
        </div>
        
        <!-- Backup Configuration -->
        <div class="config-section">
            <h2>💾 Database Backup</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="backupEnabled">Enable Auto Backup</label>
                    <select id="backupEnabled">
                        <option value="true">Enabled</option>
                        <option value="false">Disabled</option>
                    </select>
                    <div class="help-text">Automatically backup database at regular intervals.</div>
                </div>
                <div class="config-item">
                    <label for="backupTest">Test Backup System</label>
                    <button type="button" id="testBackup" class="secondary">Test Backup</button>
                    <div class="test-results" id="backupTestResults"></div>
                </div>
                <div class="config-item">
                    <label for="backupCreate">Create Manual Backup</label>
                    <button type="button" id="createBackup" class="secondary">Create Backup</button>
                    <div class="help-text">Create a backup immediately.</div>
                </div>
                <div class="config-item">
                    <label for="backupDir">Backup Directory</label>
                    <input type="text" id="backupDir" placeholder="./data/backups">
                    <div class="help-text">Directory where database backups are stored.</div>
                </div>
            </div>
        </div>

        <!-- Telegram Configuration -->
        <div class="config-section">
            <h2>📱 Telegram Notifications</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="telegramEnabled">Enable Telegram Notifications</label>
                    <select id="telegramEnabled">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                    <div class="help-text">Enable Telegram notifications for detections and alerts.</div>
                </div>
                <div class="config-item">
                    <label for="telegramToken">Bot Token</label>
                    <input type="password" id="telegramToken" placeholder="123456789:ABC...">
                    <div class="help-text">Telegram bot token from @BotFather. This will be stored securely.</div>
                </div>
                <div class="config-item">
                    <label for="telegramDefaultChat">Default Chat ID</label>
                    <input type="text" id="telegramDefaultChat" placeholder="123456789">
                    <div class="help-text">Default chat ID for general notifications.</div>
                </div>
                <div class="config-item">
                    <label for="telegramSecurityChat">Security Group Chat ID</label>
                    <input type="text" id="telegramSecurityChat" placeholder="-1001234567890">
                    <div class="help-text">Chat ID for security alerts and person detections.</div>
                </div>
            </div>
        </div>

        <!-- Error Notifications Configuration -->
        <div class="config-section">
            <h2>🚨 Error Notifications</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="errorNotificationsEnabled">Enable Error Notifications</label>
                    <select id="errorNotificationsEnabled">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                    <div class="help-text">Enable error notifications via Python endpoint.</div>
                </div>
                <div class="config-item">
                    <label for="errorNotificationsPythonEndpoint">Python Endpoint URL</label>
                    <input type="text" id="errorNotificationsPythonEndpoint" placeholder="http://localhost:5000">
                    <div class="help-text">URL of your Python endpoint that handles error notifications.</div>
                </div>
                <div class="config-item">
                    <label for="testErrorNotifications">Test Error Notifications</label>
                    <button type="button" id="testErrorNotifications" class="secondary">Test Error Notifications</button>
                    <div class="help-text">Test the error notification system by sending a test error.</div>
                </div>
            </div>
        </div>

        <!-- Security Configuration -->
        <div class="config-section">
            <h2>🔒 Security Settings</h2>
            <div class="config-grid">
                <div class="config-item">
                    <label for="rateLimitEnabled">Enable Rate Limiting</label>
                    <select id="rateLimitEnabled">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                    <div class="help-text">Enable rate limiting to prevent abuse.</div>
                </div>
                <div class="config-item">
                    <label for="rateLimitRequests">Rate Limit (requests per window)</label>
                    <input type="number" id="rateLimitRequests" placeholder="100" min="1" max="10000">
                    <div class="help-text">Maximum requests per time window.</div>
                </div>
                <div class="config-item">
                    <label for="rateLimitWindow">Rate Limit Window</label>
                    <select id="rateLimitWindow">
                        <option value="1m">1 Minute</option>
                        <option value="5m">5 Minutes</option>
                        <option value="15m">15 Minutes</option>
                        <option value="1h">1 Hour</option>
                    </select>
                    <div class="help-text">Time window for rate limiting.</div>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="button-group">
            <button id="saveConfig" class="primary">
                <span>💾</span>
                Save Configuration
            </button>
            <button id="testConfig" class="secondary">
                <span>🧪</span>
                Test Configuration
            </button>
            <button id="testTelegram" class="secondary">
                <span>📱</span>
                Test Telegram
            </button>
            <button id="resetConfig" class="secondary">
                <span>🔄</span>
                Reset to Defaults
            </button>
            <button id="restartService" class="danger">
                <span>🔄</span>
                Restart Service
            </button>
        </div>
        
        <!-- Test Results -->
        <div class="test-results" id="testResults">
            <h4>Configuration Test Results</h4>
            <pre id="testOutput"></pre>
        </div>
    </main>
    
    <script>
        // Configuration management
        let currentConfig = {};
        
        // Load configuration on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu functionality
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            const mobileNav = document.getElementById('mobileNav');
            
            // Toggle mobile menu
            mobileMenuToggle.addEventListener('click', function() {
                mobileMenuToggle.classList.toggle('active');
                mobileNav.classList.toggle('show');
            });
            
            // Close mobile menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!mobileMenuToggle.contains(event.target) && !mobileNav.contains(event.target)) {
                    mobileMenuToggle.classList.remove('active');
                    mobileNav.classList.remove('show');
                }
            });
            
            loadConfiguration();
        });
        
        // Load configuration from server
        async function loadConfiguration() {
            try {
                const response = await fetch('/api/config');
                if (response.ok) {
                    currentConfig = await response.json();
                    populateForm(currentConfig);
                    showStatus('Configuration loaded successfully', 'success');
                } else {
                    showStatus('Failed to load configuration', 'error');
                }
            } catch (error) {
                console.error('Error loading configuration:', error);
                showStatus('Error loading configuration: ' + error.message, 'error');
            }
        }
        
        // Populate form with configuration values
        function populateForm(config) {
            // Camera directory
            document.getElementById('cameraDir').value = config.camera_dir || '';
            document.getElementById('serverHost').value = config.server_host || '0.0.0.0';
            document.getElementById('serverPort').value = config.server_port || 8080;
            document.getElementById('corsOrigins').value = config.cors_origins || '*';
            
            // Database
            document.getElementById('dbPath').value = config.db_path || './data/events.db';
            document.getElementById('dbBackupEnabled').value = config.db_backup_enabled ? 'true' : 'false';
            document.getElementById('dbBackupInterval').value = config.db_backup_interval || '24h';
            
            // Backup
            document.getElementById('backupEnabled').value = config.backup_enabled ? 'true' : 'false';
            document.getElementById('backupDir').value = config.backup_dir || './data/backups';
            
            // AI Detection
            document.getElementById('gpuDetectionUrl').value = config.gpu_detection_url || '';
            document.getElementById('gpuDetectionTimeout').value = config.gpu_detection_timeout || 30;
            document.getElementById('detectionConfidence').value = config.detection_confidence || 0.45;
            document.getElementById('detectionClasses').value = config.detection_classes || 'person,car,truck,bus,bicycle,motorcycle,dog,bird';
            
            // Performance
            document.getElementById('maxWorkers').value = config.max_workers || 8;
            document.getElementById('thumbnailQuality').value = config.thumbnail_quality || 85;
            document.getElementById('thumbnailSize').value = config.thumbnail_size || 320;
            document.getElementById('cacheSize').value = config.cache_size || 100;
            
            // Security
            document.getElementById('rateLimitEnabled').value = config.rate_limit_enabled ? 'true' : 'false';
            document.getElementById('rateLimitRequests').value = config.rate_limit_requests || 100;
            document.getElementById('rateLimitWindow').value = config.rate_limit_window || '1m';
            
            // Telegram
            document.getElementById('telegramEnabled').value = config.telegram_enabled ? 'true' : 'false';
            document.getElementById('telegramToken').value = config.telegram_token || '';
            document.getElementById('telegramDefaultChat').value = config.telegram_default_chat || '';
            document.getElementById('telegramSecurityChat').value = config.telegram_security_chat || '';
            
            // Error Notifications
            document.getElementById('errorNotificationsEnabled').value = config.error_notifications_enabled ? 'true' : 'false';
            document.getElementById('errorNotificationsPythonEndpoint').value = config.error_notifications_python_endpoint || 'http://localhost:5000';
        }
        
        // Collect form data
        function collectFormData() {
            return {
                camera_dir: document.getElementById('cameraDir').value,
                server_host: document.getElementById('serverHost').value,
                server_port: parseInt(document.getElementById('serverPort').value),
                cors_origins: document.getElementById('corsOrigins').value,
                db_path: document.getElementById('dbPath').value,
                db_backup_enabled: document.getElementById('dbBackupEnabled').value === 'true',
                db_backup_interval: document.getElementById('dbBackupInterval').value,
                backup_enabled: document.getElementById('backupEnabled').value === 'true',
                backup_dir: document.getElementById('backupDir').value,
                gpu_detection_url: document.getElementById('gpuDetectionUrl').value,
                gpu_detection_timeout: parseInt(document.getElementById('gpuDetectionTimeout').value),
                detection_confidence: parseFloat(document.getElementById('detectionConfidence').value),
                detection_classes: document.getElementById('detectionClasses').value,
                max_workers: parseInt(document.getElementById('maxWorkers').value),
                thumbnail_quality: parseInt(document.getElementById('thumbnailQuality').value),
                thumbnail_size: parseInt(document.getElementById('thumbnailSize').value),
                cache_size: parseInt(document.getElementById('cacheSize').value),
                rate_limit_enabled: document.getElementById('rateLimitEnabled').value === 'true',
                rate_limit_requests: parseInt(document.getElementById('rateLimitRequests').value),
                rate_limit_window: document.getElementById('rateLimitWindow').value,
                telegram_enabled: document.getElementById('telegramEnabled').value === 'true',
                telegram_token: document.getElementById('telegramToken').value,
                telegram_default_chat: document.getElementById('telegramDefaultChat').value,
                telegram_security_chat: document.getElementById('telegramSecurityChat').value,
                error_notifications_enabled: document.getElementById('errorNotificationsEnabled').value === 'true',
                error_notifications_python_endpoint: document.getElementById('errorNotificationsPythonEndpoint').value
            };
        }
        
        // Show status message
        function showStatus(message, type) {
            const alert = document.getElementById('statusAlert');
            const messageEl = document.getElementById('statusMessage');
            
            messageEl.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'flex';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        
        // Save configuration
        document.getElementById('saveConfig').addEventListener('click', async function() {
            const config = collectFormData();
            
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    showStatus('Configuration saved successfully', 'success');
                    currentConfig = config;
                } else {
                    const error = await response.text();
                    showStatus('Failed to save configuration: ' + error, 'error');
                }
            } catch (error) {
                console.error('Error saving configuration:', error);
                showStatus('Error saving configuration: ' + error.message, 'error');
            }
        });
        
        // Test configuration
        document.getElementById('testConfig').addEventListener('click', async function() {
            const config = collectFormData();
            const testResults = document.getElementById('testResults');
            const testOutput = document.getElementById('testOutput');
            
            testResults.className = 'test-results show';
            testOutput.textContent = 'Testing configuration...';
            
            try {
                const response = await fetch('/api/config/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    testResults.classList.add('success');
                    testOutput.textContent = JSON.stringify(result, null, 2);
                } else {
                    testResults.classList.add('error');
                    testOutput.textContent = JSON.stringify(result, null, 2);
                }
            } catch (error) {
                testResults.classList.add('error');
                testOutput.textContent = 'Error testing configuration: ' + error.message;
            }
        });
        
        // Test Telegram
        document.getElementById('testTelegram').addEventListener('click', async function() {
            const config = collectFormData();
            const testResults = document.getElementById('testResults');
            const testOutput = document.getElementById('testOutput');
            
            testResults.className = 'test-results show';
            testOutput.textContent = 'Testing Telegram configuration...';
            
            try {
                const response = await fetch('/telegram/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    testOutput.textContent = `✅ Telegram test successful!\n\n${JSON.stringify(result, null, 2)}`;
                    showStatus('Telegram test completed successfully', 'success');
                } else {
                    testOutput.textContent = `❌ Telegram test failed:\n\n${JSON.stringify(result, null, 2)}`;
                    showStatus('Telegram test failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error testing Telegram:', error);
                testOutput.textContent = `❌ Error testing Telegram: ${error.message}`;
                showStatus('Error testing Telegram: ' + error.message, 'error');
            }
        });
        
        // Test Error Notifications
        document.getElementById('testErrorNotifications').addEventListener('click', async function() {
            const config = collectFormData();
            const testResults = document.getElementById('testResults');
            const testOutput = document.getElementById('testOutput');
            
            testResults.className = 'test-results show';
            testOutput.textContent = 'Testing Error Notifications configuration...';
            
            try {
                const response = await fetch('/error-notifications/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    testOutput.textContent = `✅ Error Notifications test successful!\n\n${JSON.stringify(result, null, 2)}`;
                    showStatus('Error Notifications test completed successfully', 'success');
                } else {
                    testOutput.textContent = `❌ Error Notifications test failed:\n\n${JSON.stringify(result, null, 2)}`;
                    showStatus('Error Notifications test failed: ' + (result.error || 'Unknown error'), 'error');
                }
            } catch (error) {
                console.error('Error testing Error Notifications:', error);
                testOutput.textContent = `❌ Error testing Error Notifications: ${error.message}`;
                showStatus('Error testing Error Notifications: ' + error.message, 'error');
            }
        });
        
        // Reset configuration
        document.getElementById('resetConfig').addEventListener('click', function() {
            if (confirm('Are you sure you want to reset all configuration to defaults? This cannot be undone.')) {
                populateForm({});
                showStatus('Configuration reset to defaults', 'info');
            }
        });
        
        // Restart service
        document.getElementById('restartService').addEventListener('click', async function() {
            if (confirm('Are you sure you want to restart the service? This will temporarily interrupt service.')) {
                try {
                    const response = await fetch('/api/config/restart', {
                        method: 'POST'
                    });
                    
                    if (response.ok) {
                        showStatus('Service restart initiated', 'info');
                    } else {
                        showStatus('Failed to restart service', 'error');
                    }
                } catch (error) {
                    showStatus('Error restarting service: ' + error.message, 'error');
                }
            }
        });
        
        // Test backup system
        document.getElementById('testBackup').addEventListener('click', async function() {
            const testResults = document.getElementById('backupTestResults');
            
            testResults.className = 'test-results show';
            testResults.innerHTML = '<h4>🔄 Testing...</h4><pre>Testing backup system...</pre>';
            
            try {
                const response = await fetch('/api/backup/test', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok && result.valid) {
                    testResults.className = 'test-results show success';
                    testResults.innerHTML = `<h4>✅ Success</h4><pre>${result.message}</pre>`;
                } else {
                    testResults.className = 'test-results show error';
                    testResults.innerHTML = `<h4>❌ Error</h4><pre>${result.error || result.message}</pre>`;
                }
            } catch (error) {
                testResults.className = 'test-results show error';
                testResults.innerHTML = `<h4>❌ Error</h4><pre>Error testing backup system: ${error.message}</pre>`;
            }
        });

        // Create manual backup
        document.getElementById('createBackup').addEventListener('click', async function() {
            const button = document.getElementById('createBackup');
            const originalText = button.innerHTML;
            
            button.innerHTML = '<span class="loading"></span> Creating Backup...';
            button.disabled = true;
            
            try {
                const response = await fetch('/api/backup/create', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showStatus('Backup created successfully', 'success');
                } else {
                    showStatus('Failed to create backup: ' + result.error, 'error');
                }
            } catch (error) {
                showStatus('Error creating backup: ' + error.message, 'error');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });


        // Test camera directory
        document.getElementById('testCameraDir').addEventListener('click', async function() {
            const cameraDir = document.getElementById('cameraDir').value;
            const testResults = document.getElementById('cameraDirTestResults');
            
            if (!cameraDir) {
                testResults.className = 'test-results show error';
                testResults.innerHTML = '<h4>❌ Error</h4><pre>Please enter a camera directory path</pre>';
                return;
            }
            
            testResults.className = 'test-results show';
            testResults.innerHTML = '<h4>🔄 Testing...</h4><pre>Testing camera directory access...</pre>';
            
            try {
                const response = await fetch('/api/config/test-directory', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: cameraDir })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    testResults.className = 'test-results show success';
                    testResults.innerHTML = `<h4>✅ Success</h4><pre>${JSON.stringify(result, null, 2)}</pre>`;
                } else {
                    testResults.className = 'test-results show error';
                    testResults.innerHTML = `<h4>❌ Error</h4><pre>${JSON.stringify(result, null, 2)}</pre>`;
                }
            } catch (error) {
                testResults.className = 'test-results show error';
                testResults.innerHTML = `<h4>❌ Error</h4><pre>Error testing directory: ${error.message}</pre>`;
            }
        });
    </script>
</body>
</html>
